<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate a p-value for correlation with permutation. — compute_permp • jazzPanda</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate a p-value for correlation with permutation. — compute_permp"><meta name="description" content="This function will run permutation framework to compute a p-value for the
correlation between the vectorised genes and clusters each cluster for one
sample."><meta property="og:description" content="This function will run permutation framework to compute a p-value for the
correlation between the vectorised genes and clusters each cluster for one
sample."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">jazzPanda</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/jazzPanda.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/phipsonlab/jazzPanda/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate a p-value for correlation with permutation.</h1>
      <small class="dont-index">Source: <a href="https://github.com/phipsonlab/jazzPanda/blob/main/R/compute_permp.R" class="external-link"><code>R/compute_permp.R</code></a></small>
      <div class="d-none name"><code>compute_permp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function will run permutation framework to compute a p-value for the
correlation between the vectorised genes and clusters each cluster for one
sample.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">compute_permp</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">cluster_info</span>,</span>
<span>  <span class="va">perm.size</span>,</span>
<span>  <span class="va">bin_type</span>,</span>
<span>  <span class="va">bin_param</span>,</span>
<span>  <span class="va">test_genes</span>,</span>
<span>  correlation_method <span class="op">=</span> <span class="st">"pearson"</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  correction_method <span class="op">=</span> <span class="st">"BH"</span>,</span>
<span>  <span class="va">w_x</span>,</span>
<span>  <span class="va">w_y</span>,</span>
<span>  use_cm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a SingleCellExperiment or SpatialExperiment or
SpatialFeatureExperiment object</p></dd>


<dt id="arg-cluster-info">cluster_info<a class="anchor" aria-label="anchor" href="#arg-cluster-info"></a></dt>
<dd><p>A dataframe/matrix containing the centroid coordinates
and cluster label for each cell.The column names should include "x"
(x coordinate), "y" (y coordinate), and "cluster" (cluster label).</p></dd>


<dt id="arg-perm-size">perm.size<a class="anchor" aria-label="anchor" href="#arg-perm-size"></a></dt>
<dd><p>A positive number specifying permutation times</p></dd>


<dt id="arg-bin-type">bin_type<a class="anchor" aria-label="anchor" href="#arg-bin-type"></a></dt>
<dd><p>A string indicating which bin shape is to be used for
vectorization. One of "square" (default), "rectangle", or "hexagon".</p></dd>


<dt id="arg-bin-param">bin_param<a class="anchor" aria-label="anchor" href="#arg-bin-param"></a></dt>
<dd><p>A numeric vector indicating the size of the bin. If the
<code>bin_type</code> is "square" or "rectangle", this will be a vector of length
two giving the numbers of rectangular quadrats in the x and y directions. If
the <code>bin_type</code> is "hexagonal", this will be a number giving the side
length of hexagons. Positive numbers only.</p></dd>


<dt id="arg-test-genes">test_genes<a class="anchor" aria-label="anchor" href="#arg-test-genes"></a></dt>
<dd><p>A vector of strings giving the name of the genes you
want to test correlation for.
<code>gene_mt</code>.</p></dd>


<dt id="arg-correlation-method">correlation_method<a class="anchor" aria-label="anchor" href="#arg-correlation-method"></a></dt>
<dd><p>A parameter pass to <code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></code> indicating
which correlation coefficient is to be computed.
One of "pearson" (default), "kendall", or "spearman": can be abbreviated.</p></dd>


<dt id="arg-n-cores">n_cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>A positive number specifying number of cores used for
parallelizing permutation testing. Default is one core
(sequential processing).</p></dd>


<dt id="arg-correction-method">correction_method<a class="anchor" aria-label="anchor" href="#arg-correction-method"></a></dt>
<dd><p>A character string pass to <code><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></code>
specifying the correction method for multiple testing .</p></dd>


<dt id="arg-w-x">w_x<a class="anchor" aria-label="anchor" href="#arg-w-x"></a></dt>
<dd><p>a numeric vector of length two specifying the x coordinate
limits of enclosing box.</p></dd>


<dt id="arg-w-y">w_y<a class="anchor" aria-label="anchor" href="#arg-w-y"></a></dt>
<dd><p>a numeric vector of length two specifying the y coordinate
limits of enclosing box.</p></dd>


<dt id="arg-use-cm">use_cm<a class="anchor" aria-label="anchor" href="#arg-use-cm"></a></dt>
<dd><p>A boolean value that specifies whether to create spatial
vectors for genes using the count matrix and cell coordinates instead of
the transcript coordinates when both types of information are available.
The default setting is FALSE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A named list with the following components</p>
<dl><dt><code>obs.stat</code>  </dt>
<dd><p>A matrix contains the observation statistic for
every gene and every cluster. Each row refers to a gene, and each column
refers to a cluster</p></dd>

<dt><code>perm.arrays</code>  </dt>
<dd><p>A three dimensional array.
The first two dimensions represent the correlation between the genes and
permuted clusters. The third dimension refers to the different permutation
runs.</p></dd>

<dt><code>perm.pval</code>  </dt>
<dd><p>A matrix contains the raw permutation p-value.
Each row refers to a gene, and each column refers to a cluster</p></dd>

<dt><code>perm.pval.adj</code>  </dt>
<dd><p>A matrix contains the adjusted permutation
p-value. Each row refers to a gene, and each column refers to a cluster</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>To get a permutation p-value for the correlation between a gene
and a cluster, this function will permute the cluster label for
each cell randomly, and calculate correlation between the genes and
permuted clusters. This process will be repeated for <code>perm.size</code>
times, and permutation p-value is calculated as the probability of
permuted correlations larger than the observation correlation.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pachterlab/SFEData" class="external-link">SFEData</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pachterlab/SpatialFeatureExperiment" class="external-link">SpatialFeatureExperiment</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘SpatialFeatureExperiment’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     scale</span>
<span class="r-in"><span><span class="va">sfe1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SFEData/man/McKellarMuscleData.html" class="external-link">McKellarMuscleData</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"small"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> see ?SFEData and browseVignettes('SFEData') for documentation</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> downloading 1 resources</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> retrieving 1 resource</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> loading from cache</span>
<span class="r-in"><span><span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/dge.html" class="external-link">counts</a></span><span class="op">(</span><span class="va">sfe1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># take a subset of genes for illustration</span></span></span>
<span class="r-in"><span><span class="va">keep_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">100</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># get coordinates for clusters and simulate cluster labels</span></span></span>
<span class="r-in"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SpatialExperiment/man/SpatialExperiment-methods.html" class="external-link">spatialCoords</a></span><span class="op">(</span><span class="va">sfe1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">clusters</span><span class="op">$</span><span class="va">sample</span><span class="op">&lt;-</span><span class="va">sfe1</span><span class="op">$</span><span class="va">sample_id</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">clusters</span><span class="op">$</span><span class="va">cluster</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"E"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">sfe1</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">clusters</span><span class="op">$</span><span class="va">cell_id</span><span class="op">&lt;-</span> <span class="va">sfe1</span><span class="op">$</span><span class="va">barcode</span></span></span>
<span class="r-in"><span><span class="va">w_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">w_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">perm_res</span> <span class="op">&lt;-</span> <span class="fu">compute_permp</span><span class="op">(</span>x<span class="op">=</span> <span class="va">sfe1</span>, cluster_info<span class="op">=</span><span class="va">clusters</span>, </span></span>
<span class="r-in"><span>                            perm.size<span class="op">=</span><span class="fl">10</span>, bin_type<span class="op">=</span><span class="st">"square"</span>,</span></span>
<span class="r-in"><span>                            bin_param<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,test_genes<span class="op">=</span><span class="va">keep_genes</span>,</span></span>
<span class="r-in"><span>                            correlation_method <span class="op">=</span> <span class="st">"spearman"</span>, </span></span>
<span class="r-in"><span>                            n_cores<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>                            correction_method<span class="op">=</span><span class="st">"BH"</span>,</span></span>
<span class="r-in"><span>                            w_x<span class="op">=</span><span class="va">w_x</span> ,w_y<span class="op">=</span><span class="va">w_y</span>,</span></span>
<span class="r-in"><span>                            use_cm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Correlation Method = spearman</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Running 10 permutation with 2 cores in parallel</span>
<span class="r-in"><span><span class="va">perm_pvalue</span> <span class="op">&lt;-</span> <span class="va">perm_res</span><span class="op">$</span><span class="va">perm.pval.adj</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Melody Jin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

